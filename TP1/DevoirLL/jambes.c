//
// Created by jean-daniel on 08/11/2021.
//
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include "types.h"


int main(int argc, char **argv) {
    union value empty;
    union value val1;
    val1.n = 1;
    instr instr0 = newinstr("", "push", 1, 0, 0, val1, 0, 0, empty);

    union value R0;
    R0.n = 1;
    instr instr1 = newinstr("jab", "pop", 1, 1, 0, R0, 0, 0, empty);

    union value val2; //constante 1
    R0.n = 101;
    instr instr2 = newinstr("", "cmp", 2, 1, 0, R0, 0, 0, val2);

    union value valFin;
    strcpy(valFin.name, "fin");

    instr instr3 = newinstr("", "jeq", 1, 3, 1, valFin, 0, 0, empty);

    instr instr4 = newinstr("", "prin", 1, 1, 0, R0, 0, 0, empty);

    union value incr;
    incr.n=1;
    instr instr5 = newinstr("", "push", 1, 0, 0, incr, 0, 0, empty);

    union value R1;
    R1.n=0;
    instr instr6 = newinstr("","pop",1,1,0,R1,0,0,empty);

    instr instr7 = newinstr("","add",2,1,0,R0,1,0,R1);

    union value valJab;
    strcpy(valJab.name, "jab");

    instr instr8 = newinstr("", "call", 2, 3, 1, valJab, 1, 0, R0);

    instr instr9 = newinstr("fin", "ret", 1, 1, 0, R0, 0, 0, empty);

    instr *listeinstr0 = (instr *) malloc(10 * sizeof(instr));
    listeinstr0[0] = instr0;
    listeinstr0[1] = instr1;
    listeinstr0[2] = instr2;
    listeinstr0[3] = instr3;
    listeinstr0[4] = instr4;
    listeinstr0[5] = instr5;
    listeinstr0[6] = instr6;
    listeinstr0[7] = instr7;
    listeinstr0[8] = instr8;
    listeinstr0[9] = instr9;

    module modex0 = newmod(10, listeinstr0);
}