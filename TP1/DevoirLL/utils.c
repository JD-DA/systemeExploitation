#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include "types.h"

void affichemem(int memsize, instr *mem){ // affichage dans le terminal d'une liste d'instruction, e.g. la ram, la premiere colonne donne la representation memoire utilisee ici, la seconde est de type langage d'assemblage
  printf(" ____________________________________________________________________________\n");
  for (int i=memsize-1;i>=0;i--){
    printf("%3d | ",i);
    printf("%6s ",mem[i].def);
    printf("%6s ",mem[i].name);
    for (int j=0;j<mem[i].nbarg;j++){
      if (mem[i].args[j].intorname == 1){
	printf(" (%d,%3s)",mem[i].args[j].type,mem[i].args[j].val.name);
      }
      else {
	printf(" (%d,%3d)",mem[i].args[j].type,mem[i].args[j].val.n);
      }
    }
    for (int j=mem[i].nbarg;j<2;j++){
      printf("        ");
    }
    printf("     |     ");
    printf("%3d | ",i);
    printf("%6s ",mem[i].def);
    printf("%6s ",mem[i].name);
    for (int j=0;j<mem[i].nbarg;j++){
      if (mem[i].args[j].intorname == 1){
	printf(" %3s",mem[i].args[j].val.name);
      }
      else {
	if (mem[i].args[j].type == 1){
	  printf("  R%d",mem[i].args[j].val.n);
	}
	else {
	  printf(" %3d",mem[i].args[j].val.n);
	}
      }
    }
    for (int j=mem[i].nbarg;j<2;j++){
      printf("    ");
    }
    printf("  |\n");
  }
  printf(" ____________________________________________________________________________\n");
}

arginstr newarg (char type, char intorname, union value val){ //creation d'un element de type argument d'une instruction
  arginstr arg = {type, intorname, val};
  return arg;
}

instr newinstr (char * def,char *name,char nbarg, char type0, char intorname0, union value val0, char type1, char intorname1, union value val1){ //creation d'un element de type instruction
  instr ins;
  ins.def = def;
  ins.name = name;
  ins.nbarg = nbarg;
  ins.args = (arginstr *)malloc(ins.nbarg * sizeof(arginstr));
  ins.args[0]=newarg(type0,intorname0, val0);
  if (nbarg==2){
    ins.args[1]=newarg(type1,intorname1, val1);
  };
  return(ins);
}

module newmod (int size,instr *listeinstr){
  //creation d'un element de type module
  module mod;
  mod.size = size;
  mod.listeinstr = listeinstr;
  return mod;
}
